<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini Bike Mechanic</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body style="background:#111;color:#eee;font-family:sans-serif;line-height:1.6;">

  <h1>üèç Mini Bike Mechanic</h1>

  <p>Hello! I rebuild broken minibikes and can fix yours. If you want to sell me your bike or need a repair, contact me below or via <a href="https://www.instagram.com/eaqko/" target="_blank">Instagram</a>.</p>

  <h2>Bikes for Sale</h2>
  <div id="bike-gallery" style="display:flex;flex-wrap:wrap;gap:10px;">
    <div class="bike" data-id="1" style="width:200px;cursor:pointer;">
      <img src="images/bike1.jpg" style="width:100%;aspect-ratio:1/1;object-fit:cover;">
      <p>Bike 1 - $150</p>
    </div>
    <div class="bike" data-id="2" style="width:200px;cursor:pointer;">
      <img src="images/bike2.jpg" style="width:100%;aspect-ratio:1/1;object-fit:cover;">
      <p>Bike 2 - $180</p>
    </div>
    <div class="bike" data-id="3" style="width:200px;cursor:pointer;">
      <img src="images/bike3.jpg" style="width:100%;aspect-ratio:1/1;object-fit:cover;">
      <p>Bike 3 - $200</p>
    </div>
    <div class="bike" data-id="4" style="width:200px;cursor:pointer;">
      <img src="images/bike4.jpg" style="width:100%;aspect-ratio:1/1;object-fit:cover;">
      <p>Bike 4 - $220</p>
    </div>
  </div>

  <h2>Contact Me</h2>
  <form id="contact-form">
    <input type="text" name="name" placeholder="Name" required style="width:100%;margin:5px 0;">
    <input type="email" name="email" placeholder="Email" required style="width:100%;margin:5px 0;">
    <textarea name="message" placeholder="Message" required style="width:100%;margin:5px 0;"></textarea>
    <button type="submit">Send Message</button>
  </form>

  <h2>Admin Login</h2>
  <button id="discord-login">Login with Discord</button>

  <script>
    // ===== Admin Login via Discord OAuth =====
    const DISCORD_USER_ID = '929694354610716712';
    let isAdmin = false;

    document.getElementById('discord-login').onclick = async () => {
      // Simple simulation for demo:
      const userId = prompt('Enter your Discord ID for demo login:');
      if(userId === DISCORD_USER_ID) {
        isAdmin = true;
        alert('Admin login successful!');
      } else {
        alert('Not authorized');
      }
    }

    // ===== Bike click to enlarge & mark sold =====
    const bikes = document.querySelectorAll('.bike');
    bikes.forEach(bike => {
      bike.onclick = () => {
        const img = bike.querySelector('img');

        // Enlarge image
        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.width = '100vw';
        modal.style.height = '100vh';
        modal.style.background = 'rgba(0,0,0,0.8)';
        modal.style.display = 'flex';
        modal.style.alignItems = 'center';
        modal.style.justifyContent = 'center';
        modal.style.zIndex = '1000';
        modal.onclick = () => document.body.removeChild(modal);

        const imgClone = img.cloneNode();
        imgClone.style.width = '80%';
        imgClone.style.height = 'auto';
        modal.appendChild(imgClone);

        document.body.appendChild(modal);

        // Only admin can mark as sold
        if(isAdmin) {
          const confirmSold = confirm('Mark this bike as SOLD?');
          if(confirmSold) {
            if(!bike.querySelector('.sold-badge')){
              const badge = document.createElement('div');
              badge.textContent = 'SOLD';
              badge.style.position = 'absolute';
              badge.style.background = 'red';
              badge.style.color = 'white';
              badge.style.padding = '2px 5px';
              badge.style.top = '0';
              badge.style.left = '0';
              badge.className = 'sold-badge';
              bike.style.position = 'relative';
              bike.appendChild(badge);
            }
          }
        }
      }
    });

    // ===== Contact Form =====
    document.getElementById('contact-form').onsubmit = async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = {
        name: form.name.value,
        email: form.email.value,
        message: form.message.value
      };

      try {
        const res = await axios.post('/api/contact.js', data);
        alert(res.data.message || 'Message sent!');
        form.reset();
      } catch (err) {
        console.error(err);
        alert('Failed to send message.');
      }
    }
  </script>

</body>
</html>
